#
# Headless distribution for battery-powered and non-GUI devices
# Based on lmp-dynamicdevices.conf but optimized for devices without displays
# or interactive user interfaces (E-Ink, sensors, IoT devices, etc.)
#

require conf/distro/lmp.conf

DISTRO = "lmp-dynamicdevices-headless"
DISTROOVERRIDES = "lmp:lmp-dynamicdevices:lmp-dynamicdevices-headless"
DISTRO_NAME = "Linux-microPlatform Dynamic Devices Headless"

# Don't allow zeroconf (avahi is viewed as a security risk)
DISTRO_FEATURES:remove = " zeroconf"

# Auto register devices
DISTRO_FEATURES:append = " auto-register"

# CRA compliance audit system for EU Cyber Resilience Act
DISTRO_FEATURES:append = " cra-audit"

# === HEADLESS OPTIMIZATION ===
# Remove all GUI frameworks and graphics acceleration for headless devices
# This significantly reduces build time, complexity, and runtime resource usage
DISTRO_FEATURES:remove = " wayland opengl x11 pulseaudio alsa vulkan"

# Remove graphics-related features that consume power and resources
DISTRO_FEATURES:remove = " directfb"

# Keep essential connectivity and security features
# DISTRO_FEATURES like wifi, bluetooth, systemd, security remain enabled

# Improv protocol (BLE/Serial) onboarding for sentai unit (if needed)
DISTRO_FEATURES:append:imx8mm-jaguar-sentai = " improv"

# Disable USB for INST board (inherited from base config)
DISTRO_FEATURES:remove:imx8mm-jaguar-inst = " usbhost usbgadget"

# Support commercial license as we need it for some audio testing
LICENSE_FLAGS_ACCEPTED:append = " commercial"

# Encrypt root directory for E-Ink board - critical for production security
# DISABLED: LUKS encryption not working properly, needs investigation
# DISTRO_FEATURES:append:imx93-jaguar-eink = " luks"

# Enable reproducible builds by setting a fixed timestamp
# This ensures identical builds from identical source code
# Set to 2021-01-01 00:00:00 UTC (1609459200)
SOURCE_DATE_EPOCH ?= "1609459200"

# === HEADLESS DEVICE OPTIMIZATION NOTES ===
# This DISTRO is optimized for:
# - E-Ink displays (static, non-interactive)
# - Battery-powered devices (5+ year life)
# - IoT sensors and data loggers
# - Headless servers and gateways
# - Any device without interactive GUI requirements
#
# Benefits:
# - Reduced build time and complexity
# - Lower runtime memory and CPU usage
# - Improved power efficiency
# - Smaller image size
# - Faster boot times
# - Focus on connectivity and core functionality
