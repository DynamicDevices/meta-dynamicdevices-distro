From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: DynamicDevices <support@dynamicdevices.co.uk>
Date: Fri, 10 Jan 2025 14:00:00 +0000
Subject: [PATCH] wifi: Don't clear secrets if stored in keyfile for headless systems

On headless systems without secret agents, NetworkManager should retry
with existing PSK from connection file instead of clearing secrets and
requesting new ones when 4-way handshake fails.

This prevents the "no secrets" error that blocks auto-reconnection on
headless embedded systems. When secrets are stored in the connection
file (psk-flags=0), we should retry with the existing PSK rather than
assuming the PSK is wrong and requesting new secrets from a non-existent
secret agent.

Signed-off-by: DynamicDevices <support@dynamicdevices.co.uk>

---
 src/core/devices/wifi/nm-device-wifi.c | 30 +++++++++++++++++++++++++++++-
 1 file changed, 29 insertions(+), 1 deletion(-)

